---
import { getSettings } from '../queries'
import Button from './Button.astro'
import Icon from './Icon.astro'

const settings = await getSettings()
const navigationItems = settings?.navigationItems || []
---

<header
  id="main-header"
  class="fixed left-0 top-0 z-40 h-fit w-full border-b border-gray-200 bg-white transition-all duration-300 ease-in-out"
>
  <div class="container flex items-center justify-between py-4">
    <a href="/">
      <Icon name="logo" />
    </a>
    <nav>
      <ul class="flex gap-6">
        {navigationItems.map(item => (
          <li>
            <Button
              label={item.name}
              href={`/${item.slug?.current ?? ''}`}
              variant="navitem"
            />
          </li>
        ))}
      </ul>
    </nav>
  </div>
</header>

<script>
  // State tracking
  let lastScrollY = 0
  const headerHeight = 96 // px - minimale scroll afstand voordat header kan verbergen

  function handleScroll() {
    if (typeof window === 'undefined') {
      return
    }

    const header = document.getElementById('main-header')
    if (!header) {
      return
    }

    const currentScrollY = window.scrollY

    // Vergelijk huidige scroll positie met vorige positie
    // Als currentScrollY > lastScrollY EN currentScrollY > headerHeight:
    //   → Gebruiker scrollt naar beneden, voorbij header → verberg header
    // Anders (scrollt naar boven of nog niet voorbij header):
    //   → Toon header

    if (currentScrollY > lastScrollY && currentScrollY > headerHeight) {
      // Scrollt naar beneden - verberg header
      header.classList.add('-translate-y-full', 'opacity-0')
      header.classList.remove('opacity-100')
    }
    else {
      // Scrollt naar boven of bovenaan pagina - toon header
      header.classList.remove('-translate-y-full', 'opacity-0')
      header.classList.add('opacity-100')
    }

    // Update lastScrollY voor volgende vergelijking
    lastScrollY = currentScrollY
  }

  // Voeg scroll event listener toe wanneer pagina geladen is
  if (typeof window !== 'undefined') {
    lastScrollY = window.scrollY
    window.addEventListener('scroll', handleScroll, { passive: true })
  }

  // Cleanup event listener bij page navigation (Astro view transitions)
  document.addEventListener('astro:before-swap', () => {
    if (typeof window !== 'undefined') {
      window.removeEventListener('scroll', handleScroll)
    }
  })
</script>
